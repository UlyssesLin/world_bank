<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<style>

body {
  font: 18px Arial;
}

p {
  margin: 0;
}
#waffle {
  margin-bottom: 30px;
}

#legend {
  font: 13px Arial;
}

</style>
</head>

<body>
<script src="https://d3js.org/d3.v3.min.js"></script>
<div id="title">
  <p>women in the workforce devided by type</p>
  </div>
  <label for="country">Choose a country:</label>
  <select name="country" id="country">
  <option value="Afghanistan">Afghanistan</option>
  <option value="Australia">Australia</option>
  <option value="Bangladesh">Bangladesh</option>
  <option value="Bhutan">Bhutan</option>
  <option value="Cambodia">Cambodia</option>
  <option value="China">China</option>
  <option value="Hong Kong SAR, China">Hong Kong SAR, China</option>
  <option value="India">India</option>
  <option value="Japan">Japan</option>
  <option value="Indonesia">Indonesia</option>
  <option value="Korea, Dem. People's Rep.">Korea, Dem. People's Rep.</option>
  <option value="Korea, Rep.">Korea, Rep.</option>
  <option value="Lao PDR">Lao PDR</option>
  <option value="Macao SAR, China">Macao SAR, China</option>
  <option value="Malaysia">Malaysia</option>
  <option value="Maldives">Maldives</option>
  <option value="Mongolia">Mongolia</option>
  <option value="Myanmar">Myanmar</option>
  <option value="Nepal">Nepal</option>
  <option value="Pakistan">Pakistan</option>
  <option value="Philippines">Philippines</option>
  <option value="Singapore">Singapore</option>
  <option value="New Zealand">New Zealand</option>
  <option value="Sri Lanka">Sri Lanka</option>
  <option value="Thailand">Thailand</option>
  <option value="Vietnam">Vietnam</option>
</select>

<label for="Year">Choose a year: </label>
  <select name="year" id="year">
  <option value="1990">1990</option>
  <option value="1991">1991</option>
  <option value="1992">1992</option>
  <option value="1993">1993</option>
  <option value="1994">1994</option>
  <option value="1995">1995</option>
  <option value="1996">1996</option>
  <option value="1997">1997</option>
  <option value="1998">1998</option>
  <option value="1999">1999</option>
  <option value="2000">2000</option>
  <option value="2001">2001</option>
  <option value="2002">2002</option>
  <option value="2003">2003</option>
  <option value="2004">2004</option>
  <option value="2005">2005</option>
  <option value="2006">2006</option>
  <option value="2007">2007</option>
  <option value="2008">2008</option>
  <option value="2009">2009</option>
  <option value="2010">2010</option>
  <option value="2011">2011</option>
  <option value="2012">2012</option>
  <option value="2013">2013</option>
  <option value="2014">2014</option>
  <option value="2015">2015</option>
  <option value="2016">2016</option>
  <option value="2017">2017</option>
  <option value="2018">2018</option>
  <option value="2019">2019</option>
  <option value="2020">2020</option>
  <option value="2021">2021</option>
</select>
<div id="waffle">
</div>
<div id="legend">
</div>
</body>

<script>

const year_dropdown = document.getElementsByName('year')
const country_dropdown = document.getElementsByName('country')
                selected_year = year_dropdown.value;
                selected_country = country_dropdown.value;

            

var total = 0;
var width,
    height,
    widthSquares = 10,
    heightSquares = 10,
    squareSize = 25,
    squareValue = 0,
    gap = 1,
    theData = [];  

var color = d3.scale.category10();

d3.csv("data.csv", function(data)
{
  //total
  //total = d3.sum(data, function(d) { return d.population; });

  data = data.filter(function(row) {
        return row['Country Name'] == 'Afghanistan' || row['Year'] == '2020';
    })

  total = data[0].test1 + data[0].test2;

  //value of a square
  squareValue = total / (widthSquares*heightSquares);
  
  //remap data
  data.forEach(function(d, i) 
  {
      d.test1 = +d.test1;
      d.units = Math.floor(d.test1/squareValue);
      theData = theData.concat(
        Array(d.units+1).join(1).split('').map(function()
          {
            return {  squareValue:squareValue,                      
                      units: d.units,
                      test1: d.test1,
                      groupIndex: i};
          })
        );
  });

  data.forEach(function(d, i) 
  {
      d.test1 = +d.test2;
      d.units = Math.floor(d.test2/squareValue);
      theData = theData.concat(
        Array(d.units+1).join(1).split('').map(function()
          {
            return {  squareValue:squareValue,                      
                      units: d.units,
                      test1: d.test2,
                      groupIndex: i};
          })
        );
  });

  width = (squareSize*widthSquares) + widthSquares*gap + 25;
  height = (squareSize*heightSquares) + heightSquares*gap + 25;

  var waffle = d3.select("#waffle")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .selectAll("div")
      .data(theData)
      .enter()
      .append("rect")
      .attr("width", squareSize)
      .attr("height", squareSize)
      .attr("fill", function(d)
      {
        return color(d.groupIndex);
      })
      .attr("x", function(d, i)
        {
          //group n squares for column
          col = Math.floor(i/heightSquares);
          return (col*squareSize) + (col*gap);
        })
      .attr("y", function(d, i)
      {
        row = i%heightSquares;
        return (heightSquares*squareSize) - ((row*squareSize) + (row*gap))
      })
      .append("title")
        .text(function (d,i) 
          {
            return "Age range: " + data[d.groupIndex].age + " | " +  d.population + " , " + d.units + "%"
          });

   //add legend with categorical data
   var legend = d3.select("#legend")
    .append("svg")
    .attr('width', 300)
    .attr('height', 200)
    .append('g')
    .selectAll("div")
    .data(data)
    .enter()
      .append("g")
      .attr('transform', function(d,i){ return "translate(0," + i*20 + ")";});
  legend.append("rect")
    .attr("width", 18)
    .attr("height", 18)
    .style("fill", function(d, i) { return color(i)});
  legend.append("text")
    .attr("x", 25)
    .attr("y", 13)
    .text( function(d) { return d.age});

    //add value of a unit square
    var legend2 = d3.select("#legend")
      .select('svg')
      .append('g')
      .attr('transform', "translate(100,0)");

legend2.append("text")    
        .attr('y', '14')    
        .attr('font-size', '18px')
        .text("Total: " + total)
        .attr("fill", "#444444");
});


</script>
</html>